generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Moment {
  id          String   @id @default(cuid())
  slug        String   @unique
  title       String
  category    String
  creatorName String?
  creatorUrl  String?
  sourceUrl   String
  imageUrl    String?
  description String
  tags        String   @default("[]") // JSON array stored as string
  publishedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Optional OG metadata
  ogTitle    String?
  ogSiteName String?

  // Year the work was created (not when added to site)
  year            Int?
  yearApproximate Boolean @default(false)

  // Extracted from image for hover overlay
  dominantColor String?

  // Link back to submission if created from one
  submission Submission?

  @@index([category])
  @@index([publishedAt])
}

model Submission {
  id            String   @id @default(cuid())

  // Visitor-provided (required)
  imageUrl      String
  sourceUrl     String
  creatorName   String

  // Visitor-provided (optional)
  creatorUrl    String?
  title         String?
  description   String?
  submitterNote String?

  // Anti-spam metadata
  submitterIp   String
  honeypot      String?

  // Review workflow
  status        SubmissionStatus @default(PENDING)
  reviewedAt    DateTime?
  reviewNote    String?

  // Link to created moment (if approved)
  momentId      String?  @unique
  moment        Moment?  @relation(fields: [momentId], references: [id])

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

enum SubmissionStatus {
  PENDING
  APPROVED
  REJECTED
}
